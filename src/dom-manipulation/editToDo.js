import { Projects } from "../modules/projects";

const editToDo = (e) => {
    // get the todo DOM
    let todoDOM = e.currentTarget.parentNode.parentNode;
    // get the todo object
    let todoEdit = e.currentTarget.nextSibling.correspondingToDo;

    let editForm = document.querySelector('#new-todo-edit');
    todoDOM.after(editForm);

    let title = document.querySelector('#new-todo-edit input:first-child');
    title.value = todoEdit.title;
    let desc = title.nextElementSibling;
    desc.value = todoEdit.description;
    let dueDate = desc.nextElementSibling.querySelector('input');
    dueDate.value = todoEdit.dueDate;
    let priority = document.querySelector('#priority-edit');
    priority.value = todoEdit.priority;
    editForm.style.display = "flex";

    const exitEditForm = () => {
        // clean up
        document.querySelector('#new-todo').after(editForm);
        editForm.style.display = "none";
    }

    let cancelButton = document.querySelector('#new-todo-edit .buttons > .red');
    let submitButton = document.querySelector('#new-todo-edit .buttons > .green');
    cancelButton.onclick = exitEditForm;

    submitButton.onclick = function() {
        // check values
        if (title.value == '') {
            window.alert("Task name can't be empty");
            return;
        }
        else if (desc.value == '') {
            window.alert("Description can't be empty");
            return;
        }
        else if (dueDate.value == '') {
            window.alert("Due date can't be empty");
            return;
        }
        // change values in the data structure
        todoEdit.title = title.value;
        todoEdit.description = desc.value;
        todoEdit.dueDate = dueDate.value;
        todoEdit.priority = priority.value;
        exitEditForm();

        todoDOM.querySelector('.title').textContent = title.value;
        todoDOM.querySelector('.description').textContent = desc.value;
        todoDOM.querySelector('.due-date').textContent = dueDate.value;
        // change priority class
        todoDOM.className = todoDOM.className.replace( /priority-([1-4])/ , `priority-${todoEdit.priority}` )
    }
}

export {
    editToDo
} 